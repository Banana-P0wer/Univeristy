<- [[3.2.1.7]]
## **🛠 Что такое VLAN и зачем она нужна?**  
**VLAN (Virtual Local Area Network)** – это виртуальная локальная сеть, которая позволяет разделить устройства внутри одной физической сети на **логические группы**.  

### **Преимущества VLAN:**  
✅ **Изоляция трафика** – устройства в разных VLAN не могут общаться напрямую.  
✅ **Гибкость** – устройства могут быть в одной VLAN, даже если физически находятся в разных местах.  
✅ **Безопасность** – пользователи разных VLAN не видят друг друга без маршрутизатора.  
✅ **Снижение нагрузки** – уменьшается широковещательный трафик, повышается производительность.  

### **Как работают VLAN?**  
- **VLAN 10** – Faculty/Staff (персонал)  
- **VLAN 20** – Student (студенты)  
- **VLAN 30** – Guest (гости)  

Каждое устройство принадлежит к одной VLAN и **не может взаимодействовать с устройствами из других VLAN без маршрутизации**.  

---

## **🛠 Что такое Trunk и зачем он нужен?**  
**Trunk (транковый порт)** – это специальный интерфейс коммутатора, который **передаёт трафик сразу нескольких VLAN** между коммутаторами.  

### **Зачем нужен trunk?**  
📌 Если у тебя несколько VLAN и **коммутаторы подключены друг к другу, они должны передавать трафик всех VLAN**.  
📌 **Обычные (access) порты** могут работать **только с одной VLAN**, а **trunk** – с несколькими.  
📌 Trunk **позволяет передавать VLAN-трафик через один кабель** вместо нескольких.  

### **Как это работает?**  
- Когда **PC1 (VLAN 10) хочет связаться с PC4 (VLAN 10, но на другом коммутаторе)**, данные должны пройти через **транковый канал**.  
- **Если trunk не настроен**, устройства **не смогут общаться, даже если они в одной VLAN**.  

### **Как trunk понимает, какой трафик к какой VLAN относится?**  
- Trunk использует **802.1Q-тегирование** – специальную метку в Ethernet-кадре, указывающую номер VLAN.  
- **Native VLAN** – это VLAN, в которую попадает неразмеченный трафик (по умолчанию это VLAN 1, но в задании надо изменить на VLAN 99).  

---

## **📌 Часть 1. Проверка сетей VLAN**  

### **🔸 Шаг 1. Отобразить настроенные сети VLAN**  

**Что нужно сделать?**  
1. Проверить, что **на коммутаторе S1** настроено **9 VLAN**.  
2. Посмотреть, какие **порты относятся к каким VLAN**.  
3. Убедиться, что **на коммутаторах S2 и S3** есть такие же VLAN.  

**🛠 Команды для выполнения:**  
```bash
show vlan brief
```
**Что показывает команда?**  
- Список всех VLAN.  
- Назначенные порты.  
- По умолчанию все порты принадлежат VLAN 1, но должны быть распределены по таблице адресации.  

---

### **🔸 Шаг 2. Проверка связи между компьютерами**  

**Что проверяем?**  
- PC1 и PC4 **в одной VLAN (10)**, но **не могут пинговаться**.  
- Это связано с тем, что **между коммутаторами нет trunk-портов**, и трафик VLAN 10 просто не передаётся.  

**🛠 Команды на ПК:**  
```bash
ping 172.17.10.24  # PC1 → PC4
ping 172.17.20.25  # PC2 → PC5
ping 172.17.30.26  # PC3 → PC6
```
**Что ожидаем?**  
- **Пинг НЕ проходит**, потому что трафик VLAN не передаётся между коммутаторами.  
- **Решение:** Настроить trunk-порты на S1, S2, S3.  

---

## **📌 Часть 2. Настройка транковых каналов**  

### **🔸 Шаг 1. Настроить Trunk на S1 и задать native VLAN 99**  

**🛠 Команды на S1:**  
```bash
conf t
interface GigabitEthernet 0/1
switchport mode trunk
switchport trunk native vlan 99
exit

interface GigabitEthernet 0/2
switchport mode trunk
switchport trunk native vlan 99
exit
```
**Что делают команды?**  
✅ `switchport mode trunk` – переводит интерфейс в режим **trunk**.  
✅ `switchport trunk native vlan 99` – назначает **VLAN 99 как native VLAN**.  

**⚠️ Важно:**  
После этой команды **может появляться ошибка**:
```
CDP-4-NATIVE_VLAN_MISMATCH: Native VLAN mismatch discovered on GigabitEthernet0/1
```
**Что это значит?**  
- S1 **использует VLAN 99 как native**, а S2 и S3 всё ещё используют VLAN 1.  
- Надо **поменять native VLAN на S2 и S3**.  

---

### **🔸 Шаг 2. Проверка trunk-портов на S2 и S3**  

**🛠 Команды на S2 и S3:**  
```bash
show interfaces trunk
```
**Что проверяем?**  
- Включены ли trunk-порты?  
- Какие VLAN передаются через них?  
- Совпадают ли native VLAN?  

Если **native VLAN не совпадает** (ошибка CDP), то исправляем на S2 и S3.

---

### **🔸 Шаг 3. Устранение ошибки native VLAN на S2 и S3**  

**🛠 Команды на S2 и S3:**  
```bash
conf t
interface GigabitEthernet 0/1
switchport trunk native vlan 99
exit

interface GigabitEthernet 0/2
switchport trunk native vlan 99
exit
```
Теперь **native VLAN совпадает на всех коммутаторах** и ошибки исчезнут.  

---

### **🔸 Шаг 4. Проверка настроек S2 и S3**  

**🛠 Проверка trunk-портов:**  
```bash
show interfaces trunk
```
**🛠 Проверка native VLAN:**  
```bash
show interfaces switchport
```
**🛠 Проверка VLAN на S2 и S3:**  
```bash
show vlan brief
```
Теперь **G0/1 и G0/2 больше не принадлежат к VLAN 1**.  

---

## **📌 Финальная проверка – Работает ли теперь пинг?**  

```bash
ping 172.17.10.24  # PC1 → PC4
ping 172.17.20.25  # PC2 → PC5
ping 172.17.30.26  # PC3 → PC6
```
✅ **Ожидаемый результат:**  
- **Пинг проходит!** 🎉  
- Теперь коммутаторы передают трафик VLAN между собой через **trunk**.  
- **Ошибки native VLAN больше нет**.  

[[5.1.3.6]] ->